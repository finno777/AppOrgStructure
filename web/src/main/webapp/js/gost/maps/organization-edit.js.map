/* This file is generated — do not edit by hand! */
/* eslint-disable */
{"version":3,"sources":["organization-edit.js"],"names":["require","byData","name","val","preloader","$","appendTo","collectPhones","orgId","reduce","prev","item","trim","id","data","length","push","isNaN","phone","organization","getSubgroup","buildLink","handler","btn","on","phoneTemplate","tpl","managementApp","cr","container","find","e","stopPropagation","toggleClass","preventDefault","console","log","remove","validate","errors","text","join","parent","toggle","document","prepend","ready","each","replaceWith","options","appId","portalName","appName","fmType","allowedFileFormats","constraints","maxFileCount","onClose","close","empty","append","RSTFileManager","getFiles","path","open","title","titleShort","description","tinymce","get","getContent","phones","address","addressActual","fax","mail","site","provision","subGroupOrganizations","uuid","ico","attr","deleted","show","window","dataService","saveOrganization","then","res","hide","location","links","redirect","catch","err","error"],"mappings":"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","file":"../organization-edit.js","sourcesContent":["/* eslint-disable */\r\nrequire(['SHARED/jquery', 'SHARED/jqueryUI', 'SHARED/bluebird', 'SHARED/tinymce', 'SHARED/gostFileManager'], $ => {\r\n    const byData = (name, val) => `[data-${name}${val ? `=\"${val}\"` : ''}]`;\r\n    const preloader = (() =>  $('<div class=\"preloader\" style=\"display: none;\"/>').appendTo('body'))();\r\n    \r\n    const collectPhones = (orgId) => $('#groupForm__phones .subgroup').reduce((prev, item) => {\r\n        const val = $.trim($('.subgroup__input', item).val());\r\n        const id = +$('.subgroup__input', item).data('id');\r\n\r\n        if(val.length) {\r\n            prev.push({\r\n                id: id && !isNaN(id) ? id : null,\r\n                phone: val,\r\n                organization: orgId ? { id: orgId } : null\r\n            });\r\n        }\r\n\r\n        return prev;\r\n        \r\n    }, []);\r\n\r\n    const getSubgroup = () => {\r\n        const item = $('#orgForm__typeOrganization option:selected');\r\n        if(!item || !item.val().length || isNaN(+item.val())) {\r\n            return null;\r\n        }\r\n\r\n        return +item.val();\r\n    }\r\n    \r\n    const buildLink = (name, handler) => {\r\n        const btn = $(`<li class=\"subgroup__menu-item\"><a href=\"#\">${name}</a></li>`);\r\n        btn.on('click', handler);\r\n        return btn;\r\n    };\r\n\r\n    const phoneTemplate = (val, id) => {\r\n        const tpl = $(`\r\n            <div class=\"subgroup\">\r\n                <input type=\"text\" class=\"subgroup__input\" value=\"${val || ''}\" data-id=\"${id}\">\r\n                <button class=\"subgroup__button\" type=\"button\">\r\n                    <svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${managementApp.cr}sprite/sprite.svg#settings\"></use></svg>\r\n                </button>\r\n                <ul class=\"subgroup__menu\"></ul>\r\n            </div>\r\n        `);\r\n\r\n        const container = tpl.find('.subgroup__menu');\r\n\r\n        tpl.find('.subgroup__button').on('click', function(e) {\r\n            e.stopPropagation();\r\n            container.toggleClass('subgroup__menu--active');\r\n        });\r\n\r\n\r\n        buildLink('Удалить', e => {\r\n            e.preventDefault();\r\n            console.log('remove');\r\n            tpl.remove();\r\n        }).appendTo(container);\r\n\r\n        return tpl;\r\n    };\r\n\r\n    const validate = () => {\r\n        const errors = [];\r\n\r\n        if(!$.trim($('#orgForm__title').val()).length) {\r\n            errors.push('Полное наименование');\r\n        }\r\n\r\n        if(!$.trim($('#orgForm__titleShort').val()).length) {\r\n            errors.push('Краткое наименование');\r\n        }\r\n\r\n        if(!getSubgroup()) {\r\n            errors.push('Подгруппа организаций');\r\n        }\r\n\r\n        // if(!$.trim($('#icon').html()).length) {\r\n        //     errors.push('Иконка');\r\n        // }\r\n\r\n        $(byData('errors')).text(errors.join(', ')).parent().toggle(!!errors.length);\r\n\r\n        return !errors.length;\r\n    };\r\n\r\n    \r\n    $(document).on('click', '#addPhone', (e) => {\r\n        e.preventDefault();\r\n        $('#groupForm__phones').prepend(phoneTemplate());\r\n    });\r\n\r\n    $(document).ready(function() {\r\n\r\n        if($(byData('phone')).length) {\r\n            $(byData('phone')).each(function() {\r\n                $(this).replaceWith(phoneTemplate($(this).data('phone'), $(this).data('id')));\r\n            });\r\n        } else {\r\n            $('#groupForm__phones').prepend(phoneTemplate());\r\n        }\r\n\r\n        $(document).on('click', '#addIcon',function (e) {\r\n            e.preventDefault();\r\n            \r\n            const options = {\r\n                appId: managementApp.appId,\r\n                portalName: managementApp.portalName,\r\n                appName:'IconStore',\r\n                fmType: 'icons',\r\n                allowedFileFormats: [\"all\"],\r\n                constraints: {\r\n                    maxFileCount: 1,\r\n                },\r\n                onClose: function close() {\r\n                    $('#icon')\r\n                        .empty()\r\n                        .append($(`<img src=\"${ RSTFileManager.getFiles()[0].path }\" alt=\"Иконка\">`));\r\n                },\r\n            };\r\n            RSTFileManager.open(options);\r\n        });\r\n\r\n        $('#orgForm').on('submit', function(e) {\r\n            e.preventDefault();\r\n            if(!validate()) {\r\n                return;\r\n            }\r\n\r\n            const id = +$.trim($('#typeForm__id').val());\r\n\r\n            const data = {\r\n                id: !!id && !isNaN(id) ? id : null,\r\n                title: $.trim($('#orgForm__title').val()),\r\n                titleShort: $.trim($('#orgForm__titleShort').val()),\r\n                description: $.trim(tinymce.get('orgForm__description').getContent()),\r\n                phones: collectPhones(!!id && !isNaN(id) ? id : null),\r\n                address: $.trim($('#orgForm__address').val()),\r\n                addressActual: $.trim($('#orgForm__addressActual').val()),\r\n                fax: $.trim($('#orgForm__fax').val()),\r\n                mail: $.trim($('#orgForm__email').val()),\r\n                site: $.trim($('#orgForm__site').val()),\r\n                provision: $.trim(tinymce.get('orgForm__provision').getContent()),\r\n                subGroupOrganizations: {\r\n                    id: getSubgroup()\r\n                },\r\n                uuid: (() => {\r\n                    const ico = $('#icon img');\r\n\r\n                    return ico.length ? ico.attr('src') : '0';\r\n                })(),\r\n                deleted: false\r\n            };\r\n\r\n            preloader.show();\r\n            window.dataService.saveOrganization(data)\r\n                .then((res) => {\r\n                    preloader.hide();\r\n                    location = managementApp.links.redirect;\r\n                }).catch((err) => {\r\n                    console.error(err);\r\n                    preloader.hide();\r\n                });\r\n            \r\n        });\r\n\r\n\r\n\r\n    });\r\n});"]}