/* This file is generated — do not edit by hand! */
/* eslint-disable */
{"version":3,"sources":["division-edit.js"],"names":["require","managementApp","window","cr","byData","name","val","preloader","$","appendTo","orgTypes","organizations","groupOrganizations","subGroupOrganizations","validate","errors","trim","length","push","tinymce","get","getContent","html","text","join","parent","toggle","orgForm","init","document","on","e","preventDefault","options","appId","portalName","appName","fmType","allowedFileFormats","constraints","maxFileCount","onClose","close","empty","append","RSTFileManager","getFiles","path","open","id","governmentId","data","isNaN","title","uuid","attr","description","deleted","government","show","dataService","saveDivision","then","res","hide","location","links","catch","console","error","ready"],"mappings":"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","file":"../division-edit.js","sourcesContent":["/* eslint-disable */\r\nrequire(['SHARED/jquery', 'SHARED/jqueryUI', 'SHARED/bluebird', 'SHARED/tinymce', 'SHARED/gostFileManager'], $ => {\r\n    const managementApp = window.managementApp;\r\n    const cr = managementApp.cr;\r\n    const byData = (name, val) => `[data-${name}${val ? `=\"${val}\"` : ''}]`;\r\n    const preloader = (() =>  $('<div class=\"preloader\" style=\"display: none;\"/>').appendTo('body'))();\r\n\r\n    const orgTypes = {\r\n        organizations: 1,\r\n        groupOrganizations: 2,\r\n        subGroupOrganizations: 3\r\n    };\r\n\r\n    const validate = () => {\r\n        const errors = [];\r\n\r\n        if(!$.trim($('#divisionForm__name').val()).length) {\r\n            errors.push('Название');\r\n        }\r\n\r\n        if(!$.trim(tinymce.get('divisionForm__description').getContent()).length) {\r\n            errors.push('Задачи отдела');\r\n        }\r\n\r\n        if(!$.trim($('#icon').html()).length) {\r\n            errors.push('Иконка');\r\n        }\r\n\r\n        $(byData('errors')).text(errors.join(', ')).parent().toggle(!!errors.length);\r\n\r\n        return !errors.length;\r\n    };\r\n\r\n    const orgForm = {\r\n        init() {\r\n\r\n            $(document).on('click', '#addIcon',function (e) {\r\n                e.preventDefault();\r\n                \r\n                const options = {\r\n                    appId: managementApp.appId,\r\n                    portalName: managementApp.portalName,\r\n                    appName:'IconStore',\r\n                    fmType: 'icons',\r\n                    allowedFileFormats: [\"all\"],\r\n                    constraints: {\r\n                        maxFileCount: 1,\r\n                    },\r\n                    onClose: function close() {\r\n                        $('#icon')\r\n                            .empty()\r\n                            .append($(`<img src=\"${ RSTFileManager.getFiles()[0].path }\" alt=\"Иконка\">`));\r\n                    },\r\n                };\r\n                RSTFileManager.open(options);\r\n            });\r\n\r\n            $('#divisionForm').on('submit', function(e) {\r\n                e.preventDefault();\r\n                if(!validate()) {\r\n                    return;\r\n                }\r\n\r\n                const id = +$('#divisionForm__id').val();\r\n                const governmentId = +$('#divisionForm__governmentId').val();\r\n\r\n                const data = {\r\n                    id: !!id && !isNaN(id) ? id : null,\r\n                    title: $.trim($('#divisionForm__name').val()),\r\n                    uuid: $('#icon img').attr('src'),\r\n                    description: $.trim(tinymce.get('divisionForm__description').getContent()),\r\n                    deleted: false,\r\n                    government: {\r\n                        id: governmentId\r\n                    }\r\n                };\r\n\r\n                preloader.show();\r\n                window.dataService.saveDivision(data).then((res) => {\r\n                    preloader.hide();\r\n                    location = managementApp.links.government;\r\n                }).catch(() => {\r\n                    console.error('error');\r\n                    preloader.hide();\r\n                });\r\n                \r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    $(document).ready(function () {\r\n        orgForm.init();\r\n    });\r\n\r\n});\r\n"]}