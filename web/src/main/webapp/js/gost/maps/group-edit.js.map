/* This file is generated — do not edit by hand! */
/* eslint-disable */
{"version":3,"sources":["group-edit.js"],"names":["require","byData","name","val","preloader","$","appendTo","buildLink","handler","btn","on","subgroupTemplate","subgroup","tpl","title","id","managementApp","cr","container","find","e","stopPropagation","toggleClass","preventDefault","remove","getTypeOrganization","item","length","isNaN","collectSubgroups","groupid","reduce","prev","$input","trim","data","push","deleted","group","validator","required","message","maxlength","max","rules","titleShort","validate","errors","forEach","prop","some","x","gostValidation","setFieldInvalid","tinymce","get","getContent","text","join","parent","toggle","orgFormAttachs","IMAGE","DOC","transformToAttachmentsModel","file","isPreview","preview","extName","extension","fileName","displayName","size","type","uniqID","uuid","resetPreview","filter","ajax","headers","application","secret_app_id","url","processData","contentType","renderPreview","$previewContainer","fileInfo","empty","append","toLowerCase","bytesToSize","bytes","sizes","i","parseInt","Math","floor","log","round","pow","collectFiles","attachments","each","path","subgroups","prepend","attach","document","$fileField","isPreviewField","attr","allowedFormats","split","maxFiles","options","appId","portalName","appName","allowedFileFormats","constraints","maxFileCount","onClose","close","selectedFiles","RSTFileManager","getFiles","open","parents","fmType","setAllValid","scrollToFirstError","typeOrganization","description","subGroups","ico","show","window","dataService","saveGroupOrganizations","then","res","hide","location","links","redirect","catch","err","console","error"],"mappings":"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","file":"../group-edit.js","sourcesContent":["/* eslint-disable */\r\nrequire(['SHARED/jquery', 'SHARED/jqueryUI', 'SHARED/bluebird', 'SHARED/gostFileManager', 'SHARED/gostValidation'], $ => {\r\n    const byData = (name, val) => `[data-${name}${val ? `=\"${val}\"` : ''}]`;\r\n    const preloader = (() =>  $('<div class=\"preloader\" style=\"display: none;\"/>').appendTo('body'))();\r\n\r\n    const buildLink = (name, handler) => {\r\n        const btn = $(`<li class=\"subgroup__menu-item\"><a href=\"#\">${name}</a></li>`);\r\n        btn.on('click', handler);\r\n        return btn;\r\n    };\r\n\r\n    const subgroupTemplate = (subgroup) => {\r\n        const tpl = $(`\r\n            <div class=\"subgroup\">\r\n                <input type=\"text\" class=\"subgroup__input\" value=\"${subgroup ? subgroup.title : ''}\" data-subgroup-id=\"${subgroup ? subgroup.id : ''}\">\r\n                <button class=\"subgroup__button\" type=\"button\">\r\n                    <svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${managementApp.cr}sprite/sprite.svg#settings\"></use></svg>\r\n                </button>\r\n                <ul class=\"subgroup__menu\"></ul>\r\n            </div>\r\n        `);\r\n\r\n        const container = tpl.find('.subgroup__menu');\r\n\r\n        tpl.find('.subgroup__button').on('click', function(e) {\r\n            e.stopPropagation();\r\n            container.toggleClass('subgroup__menu--active');\r\n        });\r\n\r\n\r\n        buildLink('Удалить', e => {\r\n            e.preventDefault();\r\n            tpl.remove();\r\n        }).appendTo(container);\r\n\r\n        return tpl;\r\n    };\r\n\r\n    const getTypeOrganization = () => {\r\n        const item = $('#groupForm__typeOrganization option:selected');\r\n        if(!item || !item.val().length || isNaN(+item.val())) {\r\n            return null;\r\n        }\r\n\r\n        return +item.val();\r\n    }\r\n\r\n    const collectSubgroups = (groupid) => $('#groupForm__subgroups .subgroup').reduce((prev, item) => {\r\n        const $input = $('.subgroup__input', item);\r\n        const val = $.trim($input.val());\r\n        const id = $input.data('subgroup-id');\r\n\r\n        if(val.length) {\r\n            prev.push({\r\n                deleted: false,\r\n                title: val,\r\n                id: id ? +id : null,\r\n                group: groupid ? {\r\n                    id: groupid\r\n                } : null\r\n            });\r\n        }\r\n\r\n        return prev;\r\n        \r\n    }, []);\r\n\r\n    const validator = {\r\n        required: () => ({ validator: val => !!val.trim().length, message: 'Не заполнено обязательное поле' }),\r\n        maxlength: max => ({ validator: val => val.trim().length <= max, message: `Превышает ${max} символов` }),\r\n    }\r\n\r\n    const rules = {\r\n        title: [\r\n            validator.required(),\r\n            validator.maxlength(248)\r\n        ],\r\n        titleShort: [\r\n            validator.required(),\r\n            validator.maxlength(64)\r\n        ],\r\n        \r\n    }\r\n\r\n    const validate = () => {\r\n        const errors = [];\r\n\r\n        ;['title', 'titleShort'].forEach(prop => {\r\n            if(rules[prop].some(x => {\r\n                if(x.validator($.trim($(`#groupForm__${prop}`).val()))) return false;\r\n\r\n                gostValidation.setFieldInvalid($(byData('prop-name', prop)), x.message);\r\n                return true;\r\n            })) {\r\n                errors.push($(byData('key'), byData('prop-name', prop)).data('key'));\r\n            }\r\n        });\r\n\r\n        if(!getTypeOrganization()) {\r\n            errors.push($(byData('key'), byData('prop-name', 'typeOrganization')).data('key'));\r\n            gostValidation.setFieldInvalid($(byData('prop-name', 'typeOrganization')), validator.required().message);\r\n        }\r\n        \r\n        if($.trim(tinymce.get('groupForm__description').getContent()).length > 8192) {\r\n            errors.push($(byData('key'), byData('prop-name', 'description')).data('key'));\r\n            gostValidation.setFieldInvalid($(byData('prop-name', 'description')), validator.maxlength(8192).message);\r\n        }\r\n\r\n        // if(!$.trim($('#icon').html()).length) {\r\n        //     errors.push('Иконка');\r\n        // }\r\n\r\n        $(byData('errors')).text(errors.join(', ')).parent().toggle(!!errors.length);\r\n\r\n        return !errors.length;\r\n    };\r\n\r\n    //#region\r\n\r\n    const orgFormAttachs = {\r\n        IMAGE: [],\r\n        DOC: [],\r\n    };\r\n\r\n    const transformToAttachmentsModel = (file, isPreview) => ({\r\n        id: null,\r\n        preview: isPreview === 'true',\r\n        extName: file.extension,\r\n        fileName: file.displayName || file.fileName,\r\n        size: file.size,\r\n        type: file.type,\r\n        uniqID: file.uniqID,\r\n        uuid: file.uuid,\r\n    });\r\n\r\n    const resetPreview = () => {\r\n        orgFormAttachs.IMAGE = orgFormAttachs.IMAGE.filter(function (item) {\r\n            if (item.preview === true && item.id) {\r\n                $.ajax({\r\n                    headers: {\r\n                        'gtn.access.appid': managementApp.application.secret_app_id\r\n                    },\r\n                    url: `${managementApp.cr}/file/removeAttachment.action?id=${item.id}`,\r\n                    type: 'POST',\r\n                    processData: false,\r\n                    contentType: false\r\n                });\r\n            }\r\n            return item.preview !== true;\r\n        });\r\n    }\r\n\r\n    const renderPreview = ($previewContainer, fileInfo) => {\r\n        switch (fileInfo.type) {\r\n            case 'IMAGE':\r\n                if (fileInfo.preview) {\r\n                    $previewContainer.empty();\r\n                }\r\n                $previewContainer.append(`\r\n                        <div class=\"preview-item\" data-extension=\"${fileInfo.extName}\" data-filename=\"${fileInfo.fileName}\" data-size=\"${fileInfo.size}\" data-uniqid=\"${fileInfo.uniqID}\" data-id=\"${fileInfo.id}\" data-uuid=\"${fileInfo.uuid}\" data-type=\"${fileInfo.type}\" data-path=\"${managementApp.cr}/image-api/view.ido?uuid=${fileInfo.uuid}\">\r\n                            <img src=\"${managementApp.cr}/image-api/view.ido?uuid=${fileInfo.uuid}\" class=\"preview-item__img\">\r\n                            <div class=\"preview-item__remove-btn\">\r\n                                <svg>\r\n                                     <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${managementApp.cr}/sprite/sprite.svg#icon-close\"></use>\r\n                                </svg>\r\n                            </div>\r\n                        </div>\r\n                 `);\r\n                break;\r\n            default:\r\n                $previewContainer.append(`\r\n                        <div class=\"preview-item preview-item--doc\" data-extension=\"${fileInfo.extName}\" data-filename=\"${fileInfo.fileName}\" data-uniqid=\"${fileInfo.uniqID}\" data-size=\"${fileInfo.size}\" data-id=\"${fileInfo.id}\" data-uuid=\"${fileInfo.uuid}\" data-type=\"${fileInfo.type}\" data-path=\"${managementApp.cr}/image-doc/view.ido?uuid=${fileInfo.uuid}\">\r\n                            <div class=\"preview-item__doc-pic\">\r\n                                <svg>\r\n                                    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${managementApp.cr}/sprite/sprite.svg#${fileInfo.extName.toLowerCase()}\"></use>\r\n                                </svg>\r\n                            </div>\r\n                            <span class=\"preview-item__doc\">${fileInfo.fileName}</span>\r\n                            <div class=\"preview-item__remove-btn preview-item__remove-btn--transparent\">\r\n                                <svg>\r\n                                    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${managementApp.cr}/sprite/sprite.svg#icon-close\"></use>\r\n                                </svg>\r\n                            </div>\r\n                        </div>\r\n                    `);\r\n                break;\r\n        }\r\n    };\r\n\r\n    const bytesToSize = (bytes) => {\r\n        let sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n        if (bytes === 0) return '0 Byte';\r\n        let i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));\r\n        return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];\r\n    }\r\n\r\n    const collectFiles = () => {\r\n        const attachments = [];\r\n\r\n        $('.preview-item').each(function () {\r\n            attachments.push({\r\n                extName: $(this).data('extension'),\r\n                fileName: $(this).data('filename'),\r\n                size: bytesToSize($(this).data('size')),\r\n                uniqID: $(this).data('uniqid'),\r\n                type: $(this).data('type'),\r\n                uuid: $(this).data('uuid'),\r\n                path: $(this).data('type') === 'IMAGE' ? `${managementApp.cr}/image-api/view.ido?uuid=${$(this).data('uuid')}` : `${managementApp.cr}/doc-api/view.ido?uuid=${$(this).data('uuid')}`\r\n            });\r\n        });\r\n\r\n        return attachments;\r\n    }\r\n\r\n    if(managementApp.subgroups) {\r\n        managementApp.subgroups.forEach(item => {\r\n            $('#groupForm__subgroups').prepend(subgroupTemplate(item));\r\n        });\r\n    } else {\r\n        $('#groupForm__subgroups').prepend(subgroupTemplate());\r\n    }\r\n    \r\n    if(managementApp.attachments) {\r\n        managementApp.attachments.forEach(function (attach) {\r\n            orgFormAttachs.DOC.push(attach);\r\n            renderPreview($('#files'), attach);\r\n        });\r\n    }\r\n\r\n\r\n    $(document).on('click', '#addSubgroup', (e) => {\r\n        e.preventDefault();\r\n        $('#groupForm__subgroups').prepend(subgroupTemplate());\r\n    });\r\n\r\n    $(document).on('click', '#addFile',function (e) {\r\n        e.preventDefault();\r\n        \r\n        const $previewContainer = $('#files');\r\n        const $fileField = $(this);\r\n        const isPreviewField = $fileField.attr('data-preview');\r\n        const allowedFormats = $fileField.attr('data-allowedFormats').split(', ');\r\n        const maxFiles = +$fileField.attr('data-maxFileCount');\r\n\r\n        const options = {\r\n            appId: managementApp.appId,\r\n            portalName: managementApp.portalName,\r\n            appName: managementApp.appName,\r\n            allowedFileFormats: allowedFormats,\r\n            constraints: {\r\n                // max files count in FileManager is 20\r\n                maxFileCount: maxFiles && maxFiles <= 20 ? maxFiles : 20,\r\n            },\r\n            onClose: function close() {\r\n                const selectedFiles = RSTFileManager.getFiles();\r\n\r\n                selectedFiles.forEach(function (file) {\r\n                    const attach = transformToAttachmentsModel(file, isPreviewField);\r\n                    if (isPreviewField === 'true') {\r\n                        resetPreview();\r\n                    }\r\n                    orgFormAttachs.DOC.push(attach);\r\n                    renderPreview($previewContainer, attach);\r\n                });\r\n            },\r\n        };\r\n        RSTFileManager.open(options);\r\n    });\r\n\r\n    $(document).on('click', '.preview-item__remove-btn', function() {\r\n        $(this).parents('.preview-item').remove();\r\n    });\r\n\r\n    $(document).on('click', '#addIcon',function (e) {\r\n        e.preventDefault();\r\n        \r\n        const options = {\r\n            appId: managementApp.appId,\r\n            portalName: managementApp.portalName,\r\n            appName:'IconStore',\r\n            fmType: 'icons',\r\n            allowedFileFormats: [\"all\"],\r\n            constraints: {\r\n                maxFileCount: 1,\r\n            },\r\n            onClose: function close() {\r\n                $('#icon')\r\n                    .empty()\r\n                    .append($(`<img src=\"${ RSTFileManager.getFiles()[0].path }\" alt=\"Иконка\">`));\r\n            },\r\n        };\r\n        RSTFileManager.open(options);\r\n    });\r\n\r\n    //#endregion\r\n\r\n    $('#groupForm').on('submit', function (e) {\r\n        e.preventDefault();\r\n\r\n        gostValidation.setAllValid();\r\n        \r\n        if(!validate()) {\r\n            gostValidation.scrollToFirstError();\r\n            return;\r\n        }\r\n\r\n        const id = +$.trim($('#groupForm__id').val());\r\n\r\n        const data = {\r\n            id: id && !isNaN(id) ? id: null,\r\n            title: $.trim($('#groupForm__title').val()),\r\n            titleShort: $.trim($('#groupForm__titleShort').val()),\r\n            typeOrganization: {\r\n                id: getTypeOrganization()\r\n            },\r\n            description: $.trim(tinymce.get('groupForm__description').getContent()),\r\n            subGroups: collectSubgroups(id),\r\n            uuid: (() => {\r\n                const ico = $('#icon img');\r\n\r\n                return ico.length ? ico.attr('src') : '0';\r\n            })(),\r\n            deleted: false,\r\n            attachments: collectFiles()\r\n        };\r\n\r\n        preloader.show();\r\n        window.dataService.saveGroupOrganizations(data).then(function (res) {\r\n            preloader.hide();\r\n            location = managementApp.links.redirect;\r\n        }).catch(function (err) {\r\n            console.error(err);\r\n            preloader.hide();\r\n        });\r\n\r\n    });\r\n\r\n    $('#preloader').remove();\r\n\r\n});\r\n"]}