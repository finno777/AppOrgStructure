/* This file is generated — do not edit by hand! */
/* eslint-disable */
{"version":3,"sources":["governments-person.js"],"names":["require","byData","name","val","preloader","$","appendTo","validate","errors","trim","length","push","collectFiles","text","join","parent","toggle","orgFormAttachs","IMAGE","DOC","transformToAttachmentsModel","file","isPreview","id","preview","extName","extension","fileName","size","type","uniqID","uuid","resetPreview","filter","item","ajax","headers","managementApp","application","secret_app_id","url","cr","processData","contentType","renderPreview","$previewContainer","fileInfo","empty","append","document","on","e","preventDefault","$fileField","isPreviewField","attr","allowedFormats","split","maxFiles","options","appId","portalName","appName","allowedFileFormats","constraints","maxFileCount","onClose","close","selectedFiles","RSTFileManager","getFiles","console","log","forEach","attach","open","bytesToSize","bytes","sizes","i","parseInt","Math","floor","round","pow","attachments","each","data","path","debounce","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","selectedPerson","selectPerson","person","phone","email","personTemplateDropdown","tpl","find","stopPropagation","hide","search","list","loader","show","window","dataService","getPersons","fio","roles","then","res","catch","ready","not","target","parents","keydown","gonvermentId","personId","isNaN","position","government","extend","saveGovernmentPerson","location","links","err","error"],"mappings":"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","file":"../governments-person.js","sourcesContent":["/* eslint-disable */\r\nrequire(['SHARED/jquery', 'SHARED/jqueryUI', 'SHARED/gostFileManager'], $ => {\r\n    const byData = (name, val) => `[data-${name}${val ? `=\"${val}\"` : ''}]`;\r\n    const preloader = (() =>  $('<div class=\"preloader\" style=\"display: none;\"/>').appendTo('body'))();\r\n\r\n    const validate = () => {\r\n        const errors = [];\r\n\r\n        if(!$.trim($('#personForm__name').val()).length) {\r\n            errors.push('ФИО');\r\n        }\r\n\r\n        if(!$.trim($('#personForm__position').val()).length) {\r\n            errors.push('Должность');\r\n        }\r\n\r\n        if(!$.trim($('#personForm__phone').val()).length) {\r\n            errors.push('Телефон');\r\n        }\r\n\r\n        if(!$.trim($('#personForm__email').val()).length) {\r\n            errors.push('E-mail');\r\n        }\r\n\r\n        if(!collectFiles().length) {\r\n            errors.push('Фотография');\r\n        }\r\n\r\n        $(byData('errors')).text(errors.join(', ')).parent().toggle(!!errors.length);\r\n\r\n        return !errors.length;\r\n    };\r\n\r\n    const orgFormAttachs = {\r\n        IMAGE: [],\r\n        DOC: [],\r\n    };\r\n\r\n    const transformToAttachmentsModel = (file, isPreview) => ({\r\n        id: null,\r\n        preview: isPreview === 'true',\r\n        extName: file.extension,\r\n        fileName: file.fileName,\r\n        size: file.size,\r\n        type: file.type,\r\n        uniqID: file.uniqID,\r\n        uuid: file.uuid,\r\n    });\r\n\r\n    const resetPreview = () => {\r\n        orgFormAttachs.IMAGE = orgFormAttachs.IMAGE.filter(function (item) {\r\n            if (item.preview === true && item.id) {\r\n                $.ajax({\r\n                    headers: {\r\n                        'gtn.access.appid': managementApp.application.secret_app_id\r\n                    },\r\n                    url: `${managementApp.cr}/file/removeAttachment.action?id=${item.id}`,\r\n                    type: 'POST',\r\n                    processData: false,\r\n                    contentType: false\r\n                });\r\n            }\r\n            return item.preview !== true;\r\n        });\r\n    }\r\n\r\n    const renderPreview = ($previewContainer, fileInfo) => {\r\n        switch (fileInfo.type) {\r\n            case 'IMAGE':\r\n                if (fileInfo.preview) {\r\n                    $previewContainer.empty();\r\n                }\r\n                $previewContainer.append(`\r\n                        <div class=\"preview-item\" data-extension=\"${fileInfo.extName}\" data-filename=\"${fileInfo.fileName}\" data-size=\"${fileInfo.size}\" data-uniqid=\"${fileInfo.uniqID}\" data-id=\"${fileInfo.id}\" data-uuid=\"${fileInfo.uuid}\" data-type=\"${fileInfo.type}\" data-path=\"${managementApp.cr}/image-api/view.ido?uuid=${fileInfo.uuid}\">\r\n                            <img src=\"${managementApp.cr}/image-api/view.ido?uuid=${fileInfo.uuid}\" class=\"preview-item__img\">\r\n                            <div class=\"preview-item__remove-btn\">\r\n                                <svg>\r\n                                     <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${managementApp.cr}/sprite/sprite.svg#icon-close\"></use>\r\n                                </svg>\r\n                            </div>\r\n                        </div>\r\n                 `);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    };\r\n\r\n    $(document).on('click', '#addFile',function (e) {\r\n        e.preventDefault();\r\n        \r\n        const $previewContainer = $('#photo');\r\n        const $fileField = $(this);\r\n        const isPreviewField = $fileField.attr('data-preview');\r\n        const allowedFormats = $fileField.attr('data-allowedFormats').split(', ');\r\n        const maxFiles = +$fileField.attr('data-maxFileCount');\r\n\r\n        const options = {\r\n            appId: managementApp.appId,\r\n            portalName: managementApp.portalName,\r\n            appName: managementApp.appName,\r\n            allowedFileFormats: allowedFormats,\r\n            constraints: {\r\n                // max files count in FileManager is 20\r\n                maxFileCount: maxFiles && maxFiles <= 20 ? maxFiles : 20,\r\n            },\r\n            onClose: function close() {\r\n                const selectedFiles = RSTFileManager.getFiles();\r\n                console.log(selectedFiles);\r\n\r\n                selectedFiles.forEach(function (file) {\r\n                    const attach = transformToAttachmentsModel(file, isPreviewField);\r\n                    if (isPreviewField === 'true') {\r\n                        resetPreview();\r\n                    }\r\n                    orgFormAttachs[attach.type].push(attach);\r\n                    renderPreview($previewContainer, attach);\r\n                });\r\n            },\r\n        };\r\n        RSTFileManager.open(options);\r\n    });\r\n\r\n    const bytesToSize = (bytes) => {\r\n        let sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n        if (bytes === 0) return '0 Byte';\r\n        let i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));\r\n        return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];\r\n    }\r\n\r\n    const collectFiles = () => {\r\n        const attachments = [];\r\n\r\n        $('.preview-item').each(function () {\r\n            attachments.push({\r\n                extName: $(this).data('extension'),\r\n                fileName: $(this).data('filename'),\r\n                size: bytesToSize($(this).data('size')),\r\n                uniqID: $(this).data('uniqid'),\r\n                type: $(this).data('type'),\r\n                uuid: $(this).data('uuid'),\r\n                path: $(this).data('type') === 'IMAGE' ? `${managementApp.cr}/image-api/view.ido?uuid=${$(this).data('uuid')}` : `${managementApp.cr}/doc-api/view.ido?uuid=${$(this).data('uuid')}`\r\n            });\r\n        });\r\n\r\n        return attachments;\r\n    }\r\n    const debounce = (func, wait, immediate) => {\r\n        var timeout;\r\n        \r\n        return function() {\r\n            var context = this, args = arguments;\r\n            var later = function() {\r\n                timeout = null;\r\n                if (!immediate) func.apply(context, args);\r\n            };\r\n            var callNow = immediate && !timeout;\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(later, wait);\r\n            if (callNow) func.apply(context, args);\r\n        };\r\n    }\r\n\r\n    let selectedPerson = null;\r\n    \r\n    const selectPerson = (person) => {\r\n        console.log('selected', person);\r\n        selectedPerson = person;\r\n        $('#personForm__name').val(person.name);\r\n        $('#personForm__phone').val(person.phone);\r\n        $('#personForm__email').val(person.email);\r\n        $('#personForm__personId').val(person.id);\r\n        if(person.attachments && person.attachments.length) {\r\n            resetPreview();\r\n            renderPreview($('#photo'), person.attachments[person.attachments.length - 1]);\r\n        }\r\n    }\r\n    \r\n    const personTemplateDropdown = (item) => {\r\n        const tpl = $(`<li><span>${item.name}</span></li>`);\r\n        tpl.find('span').on('click', (e) => {\r\n            console.log('click');\r\n            e.stopPropagation();\r\n            selectPerson(item);\r\n            $(byData('search-list')).hide();\r\n        });\r\n        return tpl;\r\n    };\r\n\r\n    const search = debounce(() => {\r\n        const val = $('#personForm__name').val();\r\n        const list = $(byData('search-list'));\r\n        const loader = $(byData('search-preloader'));\r\n\r\n        loader.show();\r\n    \r\n        window.dataService.getPersons({\r\n            fio: val,\r\n            roles: [ 'MANAGER' ]\r\n        }).then((res) => {\r\n            list.empty();\r\n            res.forEach((item) => {\r\n                list.append(personTemplateDropdown(item));\r\n            });\r\n            list.show();\r\n            loader.hide();\r\n        }).catch(() => {\r\n            loader.hide();\r\n        });\r\n    }, 500);\r\n    \r\n    $(document).ready(function() {\r\n        $(document).on('click', (e) => {\r\n            $(byData('search-list'))\r\n                .not(function() {\r\n                    return $(e.target).parents(byData('search-prevent')).length;\r\n                }).hide();\r\n        });\r\n\r\n        $(byData('search-arrow')).on('click', function() {\r\n            if(!$.trim($('#personForm__name').val()).length) {\r\n                search();\r\n                return;\r\n            }\r\n            $(byData('search-list')).toggle();\r\n        });\r\n        $('#personForm__name').on({\r\n            keydown() {\r\n                search();\r\n            }\r\n        });\r\n\r\n        $('#personForm').on('submit', function(e) {\r\n            e.preventDefault();\r\n            if(!validate()) {\r\n                return;\r\n            }\r\n\r\n            const gonvermentId = +$('#personForm__governmentId').val();\r\n            const id = +$('#personForm__personLinkId').val();\r\n            const personId = +$('#personForm__personId').val();\r\n\r\n            const data = {\r\n                id: !!id && !isNaN(id) ? id : null,\r\n                position: $.trim($('#personForm__position').val()),\r\n                government: {\r\n                    id: !!gonvermentId &&  !isNaN(gonvermentId) ? gonvermentId : null,\r\n                },\r\n                person: $.extend(selectedPerson || {}, {\r\n                    id: !!personId && !isNaN(personId) ? personId : null,\r\n                    name: $.trim($('#personForm__name').val()),\r\n                    phone: $.trim($('#personForm__phone').val()),\r\n                    email: $.trim($('#personForm__email').val())\r\n                })\r\n            };\r\n\r\n            data.person.attachments = collectFiles();\r\n\r\n            preloader.show();\r\n            window.dataService.saveGovernmentPerson(data)\r\n                .then((res) => {\r\n                    preloader.hide();\r\n                    location = managementApp.links.government;\r\n                }).catch((err) => {\r\n                    console.error(err);\r\n                    preloader.hide();\r\n                });\r\n            \r\n        });\r\n    });\r\n});\r\n"]}