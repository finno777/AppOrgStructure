/* This file is generated — do not edit by hand! */
/* eslint-disable */
{"version":3,"sources":["governments-edit.js"],"names":["require","managementApp","window","cr","byData","name","val","preloader","$","appendTo","curatorTemplate","selected","curators","reduce","template","item","id","description","orgTypes","organizations","groupOrganizations","subGroupOrganizations","populateChecklistItems","groups","orgtype","title","renderChecklist","items","collectChecklist","res","push","validate","errors","trim","length","html","text","join","parent","toggle","collectCurators","each","$el","find","source","government","grep","x","linkId","person","document","on","e","preventDefault","options","appId","portalName","appName","fmType","allowedFileFormats","constraints","maxFileCount","onClose","close","empty","append","RSTFileManager","getFiles","path","open","orgForm","bindHandlers","data","tinymce","get","getContent","uuid","attr","deleted","show","dataService","save","then","hide","location","links","redirectMainURL","catch","err","console","error","stopImmediatePropagation","next","prepend","wrapper","parents","sourceItem","remove","not","isEqualNode","target","contains","removeClass","toggleClass","wrap","is","init","i","prop","indexOf","trigger","ready"],"mappings":"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","file":"../governments-edit.js","sourcesContent":["/* eslint-disable */\r\nrequire(['SHARED/jquery', 'SHARED/jqueryUI', 'SHARED/bluebird', 'SHARED/tinymce', 'SHARED/gostFileManager'], $ => {\r\n    const managementApp = window.managementApp;\r\n    const cr = managementApp.cr;\r\n    const byData = (name, val) => `[data-${name}${val ? `=\"${val}\"` : ''}]`;\r\n    const preloader = (() =>  $('<div class=\"preloader\" style=\"display: none;\"/>').appendTo('body'))();\r\n    const curatorTemplate = (selected) => `\r\n        <div class=\"curator\">\r\n        \r\n            <div class=\"curator__border\"></div>\r\n\r\n            <label class=\"control__label\">ФИО куратора</label>\r\n            <div class=\"curator__control\">\r\n                <div class=\"curator__control-input\">\r\n                <select>\r\n                    <option selected>Не выбрано</option>\r\n                    ${\r\n                        managementApp.curators().reduce((template, item) => {\r\n                            return `${template}<option value=\"${item.id}\" ${selected && item.id === selected.id? 'selected' : ''}>${item.name}</option>`;\r\n                        }, '')\r\n                    }\r\n                </select>\r\n                    <svg class=\"curator__control-input-arrow\"><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${cr}/sprite/sprite.svg#arrow_down\"></use></svg>\r\n                </div>\r\n                <button class=\"curator__control-button\" type=\"button\">\r\n                    <svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${cr}sprite/sprite.svg#settings\"></use></svg>\r\n                </button>\r\n                <div class=\"curator__control-dropdown\" style=\"display: none;\">\r\n                    <a href=\"#\" data-curator=\"remove\">Удалить связку</a>\r\n                </div>\r\n            </div>\r\n        \r\n            <label class=\"control__label\">Описание</label>\r\n            <div class=\"curator__control\">\r\n                <div class=\"curator__control-input\">\r\n                    <input type=\"text\" id=\"curator__description\" value=\"${selected ? selected.description : ''}\">\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    const orgTypes = {\r\n        organizations: 1,\r\n        groupOrganizations: 2,\r\n        subGroupOrganizations: 3\r\n    };\r\n\r\n    const populateChecklistItems = (groups, orgtype) => groups\r\n        .reduce((template, item) => {\r\n            return `${template}<li><label><input type=\"checkbox\" data-org-type=\"${orgtype}\" value=\"${item.id}\"> <span>${item.title}</span></label></li>`;\r\n        }, '');\r\n\r\n    const renderChecklist = (items, id = 'checklist') => `\r\n        <div class=\"checklist\" id=\"${id}\">\r\n            <span class=\"checklist__title\">Не выбрано</span>\r\n            <ul class=\"checklist__list\">\r\n                ${items}\r\n            </ul>\r\n        </div>\r\n    `;\r\n\r\n    const collectChecklist = (orgtype) => \r\n        $(`.checklist input[data-org-type=\"${orgtype}\"]:checked`).reduce((res, item) => {\r\n            res.push({\r\n                id: +$(item).val()\r\n            });\r\n            return res;\r\n        }, []);\r\n\r\n    const validate = () => {\r\n        const errors = [];\r\n\r\n        if(!$.trim($('#governmentEditForm__title').val()).length) {\r\n            errors.push('Наименования управления');\r\n        }\r\n\r\n        if(!$.trim($('#icon').html()).length) {\r\n            errors.push('Иконка');\r\n        }\r\n\r\n        $(byData('errors')).text(errors.join(', ')).parent().toggle(!!errors.length);\r\n\r\n        return !errors.length;\r\n    };\r\n\r\n    const collectCurators = () => {\r\n        const res = [];\r\n        $('.curator').each(function() {\r\n            const $el = $(this);\r\n            const val = $el.find('select').val();\r\n            if(!!+val) {\r\n                const source = managementApp.government ? $.grep(managementApp.government.curators, x => x.id === +val) : [];\r\n                res.push({\r\n                    id: source.length ? source[0].linkId : null,\r\n                    description: $.trim($el.find('#curator__description').val()),\r\n                    person: {\r\n                        id: +val,\r\n                    }\r\n                });\r\n            }\r\n        });\r\n        return res;\r\n    }\r\n\r\n    $(document).on('click', '#addIcon',function (e) {\r\n        e.preventDefault();\r\n        \r\n        const options = {\r\n            appId: managementApp.appId,\r\n            portalName: managementApp.portalName,\r\n            appName:'IconStore',\r\n            fmType: 'icons',\r\n            allowedFileFormats: [\"all\"],\r\n            constraints: {\r\n                maxFileCount: 1,\r\n            },\r\n            onClose: function close() {\r\n                $('#icon')\r\n                    .empty()\r\n                    .append($(`<img src=\"${ RSTFileManager.getFiles()[0].path }\" alt=\"Иконка\">`));\r\n            },\r\n        };\r\n        RSTFileManager.open(options);\r\n    });\r\n\r\n    const orgForm = {\r\n        bindHandlers() {\r\n            // Handlers\r\n            $('#governmentEditForm').on('submit', function(e) {\r\n                e.preventDefault();\r\n                if(!validate()) {\r\n                    return;\r\n                }\r\n\r\n                const data = {\r\n                    title: $.trim($('#governmentEditForm__title').val()),\r\n                    description: $.trim(tinymce.get('governmentEditForm__description').getContent()),\r\n                    id: managementApp.government ? managementApp.government.id : null,\r\n                    uuid: $('#icon img').attr('src'),\r\n                    deleted: false,\r\n                    curators: collectCurators(),\r\n                    organizations: collectChecklist(orgTypes.organizations),\r\n                    groupOrganizations: collectChecklist(orgTypes.groupOrganizations),\r\n                    subGroupOrganizations: collectChecklist(orgTypes.subGroupOrganizations),\r\n                    person: managementApp.government && managementApp.government.person ? managementApp.government.person : null\r\n                };\r\n\r\n                preloader.show();\r\n                window.dataService.save(data)\r\n                    .then((res) => {\r\n                        preloader.hide();\r\n                        location = managementApp.links.redirectMainURL\r\n                    }).catch((err) => {\r\n                        console.error(err);\r\n                        preloader.hide();\r\n                    });\r\n                \r\n            });\r\n\r\n            $(document).on('click', '.curator__control-button', function(e) {\r\n                e.stopImmediatePropagation();\r\n                $(this).next('.curator__control-dropdown').toggle();\r\n            });\r\n\r\n\r\n            $('#addCurator').on('click', function(e) {\r\n                e.preventDefault();\r\n                $('#curators').prepend(curatorTemplate());\r\n            });\r\n\r\n            $(document).on('click', byData('curator', 'remove'), function(e) {\r\n                e.preventDefault();\r\n                const wrapper = $(this).parents('.curator');\r\n                const id = +$('select option:selected', wrapper).val();\r\n                const sourceItem = managementApp.government ? $.grep(managementApp.government.curators, x => x.id === id) : [];\r\n                \r\n                // if(sourceItem.length) {\r\n                //     preloader.show();\r\n                //     window.dataService.removeCurator(sourceItem[0].linkId)\r\n                //         .then(() => {\r\n                //             wrapper.remove();\r\n                //             preloader.hide();\r\n                //             managementApp.government.curators = managementApp.government ? $.grep(managementApp.government.curators, x => x.id !== id) : [];\r\n                //         }).catch((err) => {\r\n                //             console.error(err);\r\n                //             preloader.hide();\r\n                //         });\r\n                // } else {\r\n                    wrapper.remove();\r\n                // }\r\n            });\r\n\r\n            \r\n            $(document).on('click', function(e) {\r\n                $('.curator__control-dropdown').hide();\r\n                $('.checklist').not(function() {\r\n                    return this.isEqualNode(e.target) || this.contains(e.target);\r\n                }).removeClass('checklist--active');\r\n            });\r\n\r\n            $(document).on('click', '.checklist__title', function(e) {\r\n                $(this).parent().toggleClass('checklist--active');\r\n            });\r\n\r\n            $(document).on('change', '.checklist input', function() {\r\n                const wrap = $(this).parents('.checklist');\r\n\r\n                $('.checklist__title', wrap).text(\r\n                    $('label', wrap).reduce((res, item) => {\r\n                        if(!$(item).find('input').is(':checked')) {\r\n                            return res;\r\n                        }\r\n                        \r\n                        res.push($(item).find('span').text());\r\n                        return res;\r\n                    }, []).join(', ') || 'Не выбрано'\r\n                );\r\n            });\r\n        },\r\n        init() {\r\n            orgForm.bindHandlers();\r\n\r\n            $(renderChecklist(`\r\n                ${populateChecklistItems(managementApp.organizations(), orgTypes.organizations)}\r\n                ${populateChecklistItems(managementApp.groupOrganizations(), orgTypes.groupOrganizations)}\r\n            `, 'organizationsChecklist')).appendTo('#organizations');\r\n\r\n            $(renderChecklist(\r\n                populateChecklistItems(managementApp.subGroupOrganizations(), orgTypes.subGroupOrganizations),\r\n                'subOrganizationsChecklist'\r\n            )).appendTo('#suborganizations');\r\n            \r\n            // Init form with existing data\r\n            if(managementApp.government) {\r\n                $.each(managementApp.government.curators, (i, item) => {\r\n                    $('#curators').prepend(curatorTemplate(item))\r\n                } );\r\n\r\n                $('#organizationsChecklist input').each(function() {\r\n\r\n                    $(this).prop('checked', (\r\n                        managementApp.government.organizations.indexOf(+$(this).val()) > -1 &&\r\n                        +$(this).data('org-type') === orgTypes.organizations\r\n                    ) || (\r\n                        managementApp.government.groupOrganizations.indexOf(+$(this).val()) > -1 &&\r\n                        +$(this).data('org-type') === orgTypes.groupOrganizations\r\n                    ));\r\n                    $(this).trigger('change');\r\n                });\r\n                \r\n                $('#subOrganizationsChecklist input').each(function() {\r\n                    $(this).prop('checked', \r\n                        (\r\n                            managementApp.government.subGroupOrganizations.indexOf(+$(this).val()) > -1 &&\r\n                            +$(this).data('org-type') === orgTypes.subGroupOrganizations\r\n                        )\r\n                    );\r\n                    $(this).trigger('change');\r\n                });\r\n\r\n            } else {\r\n                $('#curators').prepend(curatorTemplate());\r\n            }\r\n\r\n            \r\n        }\r\n    }\r\n\r\n    $(document).ready(function () {\r\n        orgForm.init();\r\n    });\r\n\r\n});\r\n"]}